---
title: "Data Analysis using R"
output: html_notebook
---

### Import necessary packages

I will first import all the necessary packages. As I'll do data analysis, I'll use R built in functions and also `ggplot` to plot certain graphs about the data to get better insights into it.

```{r}
install.packages('ggplot2')
library('ggplot2')
library('gridExtra')
library('lubridate')
```

### Import data

The next step is to import the data that we will work with. I've taken the dataset from [Kaggle](https://www.kaggle.com/joniarroba/noshowappointments/download) about **medical apppointments** with 13 features and a lable describing whether the person showed up for the appointment or not.

```{r}
medical.dataset <- read.csv('data/dataset.csv', header = TRUE, sep = ',')
head(medical.dataset)
```

The dataset is now loaded into the notebook. Let's start exploring more information about the data.

### Exploratory data analysis

Let's start the exploratory analysis of the dataset.

#### Dataset exploration

Let's explore the information about the datset.

```{r}
print(paste("Rows: ", nrow(medical.dataset)))
print(paste("Columns: ", ncol(medical.dataset)))
```

The dataset has 110,527 rows and 14 columns out of which we know we have 13 features and 1 target.

```{r}
names(medical.dataset)
```

I'll start by renaming the target column as it's a negation. I'll also have to reverse the column values to accomodate this change.

```{r}
names(medical.dataset)[14] <- "Showed_up"
medical.dataset$Showed_up <- medical.dataset$Showed_up == 'No'
```

We have 13 features, let's explore them furthermore:

1. "PatientId": It is a unique identifier for each patient but would not be useful for any predictions.
2. "AppointmentId: It's a unique identifier for each appointment.
3. "Gender": Whether the person is a Female denoted by F or Male denoted by M.
4. "ScheduleDay": The day on which appointment was scheduled.
5. "AppointmentDay": The day of the appointment.
6. "Age": Age of the person.
7. "Neighbourhood": The neighbourhood to which the person belongs.
8. "Scholarship": Whether the person had scholarship (defined [Wikipedia](https://en.wikipedia.org/wiki/Bolsa_Fam%C3%ADlia)).
9. "Hipertension": Whether the person has hyptertension.
10. "Diabeletes": Whether the person has diabetes.
11. "Alcoholism": Whether the person is alcoholic.
12. "Handcap": Whether the person is physically challenged.
13. "SMS_received": Whether the person received a text message about the appointment.

The target variable is:

1. "Showed_up": Depicts whether the person showed up for the appointment.

```{r}
summary(medical.dataset)
```

The `summary` fuinction gives a really descriptive summary of what the dataset includes but I find using plots more useful and more understandable to get the essence of the dataset. Furthermore, the columns like Scholarship, Hipertension etc. are being considered as continuous values whereas they are just unqiue factors.

But we can begin by working with the information we get above. The minimum value of `Age` is actually `-1` which seems to be erroneous. I'll remove the records that have these values.

```{r}
medical.dataset$ScheduledDay <- as.Date(medical.dataset$ScheduledDay)
medical.dataset$AppointmentDay <- as.Date(medical.dataset$AppointmentDay)
medical.dataset$Scholarship <-as.logical(medical.dataset$Scholarship)
medical.dataset$Hipertension <-as.logical(medical.dataset$Hipertension)
medical.dataset$Diabetes <-as.logical(medical.dataset$Diabetes)
medical.dataset$Alcoholism <-as.logical(medical.dataset$Alcoholism)
medical.dataset$Handcap <-as.logical(medical.dataset$Handcap)
medical.dataset$SMS_received <-as.logical(medical.dataset$SMS_received)
medical.dataset <- medical.dataset[medical.dataset$Age > 0, ]
summary(medical.dataset)
```

```{r}
```

#### Visualizations

Let's start by visualizing the data. I'll begin by visualizing the target distribution.

```{r}
ggplot(medical.dataset, aes(Showed_up)) + 
  geom_bar(fill = 'white', color = 'orange', width = 0.4) + 
  ggtitle("Did the person show for the appointment?") + 
  labs(y="Count", x = "No show for appointment")
```

The dataset is highly skewed towards patients that showed up.

Let's see the distribution between males and females.

```{r}
ggplot(medical.dataset, aes(Gender)) + 
  geom_bar(fill = c('green', 'red'), color = c('green', 'red'), width = 0.4) + 
  ggtitle("Gender appointment distribution") + 
  labs(y="Count", x = "Gender") +
  scale_x_discrete(labels=c("M" = "Male", "F" = "Female"))
```

This data is also skewed with more females as compared to males.

Let's explore the other binary columns.

```{r}
grid.arrange(ggplot(medical.dataset, aes(x=Scholarship, fill=Showed_up)) + geom_bar(position="fill"),
             ggplot(medical.dataset, aes(x=Hipertension, fill=Showed_up)) + geom_bar(position="fill"),
             ggplot(medical.dataset, aes(x=Diabetes, fill=Showed_up)) + geom_bar(position="fill"),
             ggplot(medical.dataset, aes(x=Alcoholism, fill=Showed_up)) + geom_bar(position="fill"),
             ggplot(medical.dataset, aes(x=Handcap, fill=Showed_up)) + geom_bar(position="fill"),
             ggplot(medical.dataset, aes(x=SMS_received, fill=Showed_up)) + geom_bar(position="fill"), ncol = 2)
```

The data distribution seems almost similar for either case of all binary columns.

Let's see how early to people set up their appointments.

```{r}
date.diff <- as.data.frame(medical.dataset$AppointmentDay - medical.dataset$ScheduledDay)
names(date.diff) <- 'Days.difference'
date.diff$Days.difference <- as.numeric(date.diff$Days.difference)
ggplot(date.diff, aes(x = Days.difference)) + geom_bar() +
  ggtitle("How long before do people set up appointments?") +
  labs(y="Count", x = "Days")
```

Majority people schedule appointments 1-2 days before they plan to go. However, some few also have long term ideas and have scheudled appointments more than 50 days in advance rising upto 150+ days.